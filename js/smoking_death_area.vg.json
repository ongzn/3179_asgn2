{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "background": "#dddddd",
  "description": "Trend of Smoking Mortality by Year for a Selected Country",
  "data": {
    "url": "https://raw.githubusercontent.com/ongzn/3179_asgn2/refs/heads/main/data/death-rate-smoking%20new.csv",
    "format": {"type": "csv"}
  },
  "width": 800,
  "height": 400,
  "config": {
    "axisX": {
      "titlePadding": 10,
      "grid": false
    },
    "axisY": {
      "grid": true,
      "titlePadding": 10,
      "gridColor": "darkgray"
    }
  },
  "layer": [
    {
      "selection": {
        "CountrySelection": {
          "type": "single",
          "fields": ["Entity"],
          "bind": {
            "input": "select",
            "options": [
              null, "Afghanistan", "African Region", "Albania", "Algeria", "American Samoa", "Andorra", "Angola", "Antigua and Barbuda", "Argentina", "Armenia", "Australia", "Austria", "Azerbaijan", "Bahamas", "Bahrain", "Bangladesh", "Barbados", "Belarus", "Belgium", "Belize", "Benin", "Bermuda", "Bhutan", "Bolivia", "Bosnia and Herzegovina", "Botswana", "Brazil", "Brunei", "Bulgaria", "Burkina Faso", "Burundi", "Cambodia", "Cameroon", "Canada", "Cape Verde", "Central African Republic", "Chad", "Chile", "People's Republic of China", "Colombia", "Comoros", "Republic of the Congo", "Cook Islands", "Costa Rica", "Cote d'Ivoire", "Croatia", "Cuba", "Cyprus", "Czechia", "Democratic Republic of the Congo", "Denmark", "Djibouti", "Dominica", "Dominican Republic", "East Asia & Pacific", "East Timor", "Eastern Mediterranean Region ", "Ecuador", "Egypt", "El Salvador", "England", "Equatorial Guinea", "Eritrea", "Estonia", "Eswatini", "Ethiopia", "Europe & Central Asia", "European Region", "Fiji", "Finland", "France", "G20", "Gabon", "Gambia", "Georgia", "Germany", "Ghana", "Greece", "Greenland", "Grenada", "Guam", "Guatemala", "Guinea", "Guinea-Bissau", "Guyana", "Haiti", "High Income", "Honduras", "Hungary", "Iceland", "India", "Indonesia", "Iran", "Iraq", "Ireland", "Israel", "Italy", "Jamaica", "Japan", "Jordan", "Kazakhstan", "Kenya", "Kiribati", "Kuwait", "Kyrgyzstan", "Laos", "Latin America & Caribbean", "Latvia", "Lebanon", "Lesotho", "Liberia", "Libya", "Lithuania", "Low Income", "Lower Middle Income", "Luxembourg", "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta", "Marshall Islands", "Mauritania", "Mauritius", "Mexico", "Micronesia (country)", "Middle East & North Africa", "Middle Income", "Moldova", "Monaco", "Mongolia", "Montenegro", "Morocco", "Mozambique", "Myanmar", "Namibia", "Nauru", "Nepal", "Netherlands", "New Zealand", "Nicaragua", "Niger", "Nigeria", "Niue", "North America", "North Korea", "North Macedonia", "Northern Ireland", "Northern Mariana Islands", "Norway", "OECD Countries", "Oman", "Pakistan", "Palau", "Palestine", "Panama", "Papua New Guinea", "Paraguay", "Peru", "Philippines", "Poland", "Portugal", "Puerto Rico", "Qatar", "Region of the Americas", "Romania", "Russia", "Rwanda", "Saint Kitts and Nevis", "Saint Lucia", "Saint Vincent and the Grenadines", "Samoa", "San Marino", "Sao Tome and Principe", "Saudi Arabia", "Scotland", "Senegal", "Serbia", "Seychelles", "Sierra Leone", "Singapore", "Slovakia", "Slovenia", "Solomon Islands", "Somalia", "South Africa", "South Asia", "South Korea", "South Sudan", "South-East Asia Region", "Spain", "Sri Lanka", "Sub-Saharan Africa", "Sudan", "Suriname", "Sweden", "Switzerland", "Syria", "Taiwan", "Tajikistan", "Tanzania", "Thailand", "Togo", "Tokelau", "Tonga", "Trinidad and Tobago", "Tunisia", "Turkey", "Turkmenistan", "Tuvalu", "Uganda", "Ukraine", "United Arab Emirates", "United Kingdom", "United States", "United States Virgin Islands", "Uruguay", "Uzbekistan", "Vanuatu", "Venezuela", "Vietnam", "Wales", "Western Pacific Region ", "World", "Yemen", "Zambia", "Zimbabwe"
            ],
            "labels": [
              "All Countries",
              "Afghanistan", "African Region", "Albania", "Algeria", "American Samoa", "Andorra", "Angola", "Antigua and Barbuda", "Argentina", "Armenia", "Australia", "Austria", "Azerbaijan", "Bahamas", "Bahrain", "Bangladesh", "Barbados", "Belarus", "Belgium", "Belize", "Benin", "Bermuda", "Bhutan", "Bolivia", "Bosnia and Herzegovina", "Botswana", "Brazil", "Brunei", "Bulgaria", "Burkina Faso", "Burundi", "Cambodia", "Cameroon", "Canada", "Cape Verde", "Central African Republic", "Chad", "Chile", "Peopleâ€™s Republic of China", "Colombia", "Comoros", "Republic of the Congo", "Cook Islands", "Costa Rica", "Cote d'Ivoire", "Croatia", "Cuba", "Cyprus", "Czechia", "Democratic Republic of the Congo", "Denmark", "Djibouti", "Dominica", "Dominican Republic", "East Asia & Pacific", "East Timor", "Eastern Mediterranean Region ", "Ecuador", "Egypt", "El Salvador", "England", "Equatorial Guinea", "Eritrea", "Estonia", "Eswatini", "Ethiopia", "Europe & Central Asia", "European Region", "Fiji", "Finland", "France", "G20", "Gabon", "Gambia", "Georgia", "Germany", "Ghana", "Greece", "Greenland", "Grenada", "Guam", "Guatemala", "Guinea", "Guinea-Bissau", "Guyana", "Haiti", "High Income", "Honduras", "Hungary", "Iceland", "India", "Indonesia", "Iran", "Iraq", "Ireland", "Israel", "Italy", "Jamaica", "Japan", "Jordan", "Kazakhstan", "Kenya", "Kiribati", "Kuwait", "Kyrgyzstan", "Laos", "Latin America & Caribbean", "Latvia", "Lebanon", "Lesotho", "Liberia", "Libya", "Lithuania", "Low Income", "Lower Middle Income", "Luxembourg", "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta", "Marshall Islands", "Mauritania", "Mauritius", "Mexico", "Micronesia (country)", "Middle East & North Africa", "Middle Income", "Moldova", "Monaco", "Mongolia", "Montenegro", "Morocco", "Mozambique", "Myanmar", "Namibia", "Nauru", "Nepal", "Netherlands", "New Zealand", "Nicaragua", "Niger", "Nigeria", "Niue", "North America", "North Korea", "North Macedonia", "Northern Ireland", "Northern Mariana Islands", "Norway", "OECD Countries", "Oman", "Pakistan", "Palau", "Palestine", "Panama", "Papua New Guinea", "Paraguay", "Peru", "Philippines", "Poland", "Portugal", "Puerto Rico", "Qatar", "Region of the Americas", "Romania", "Russia", "Rwanda", "Saint Kitts and Nevis", "Saint Lucia", "Saint Vincent and the Grenadines", "Samoa", "San Marino", "Sao Tome and Principe", "Saudi Arabia", "Scotland", "Senegal", "Serbia", "Seychelles", "Sierra Leone", "Singapore", "Slovakia", "Slovenia", "Solomon Islands", "Somalia", "South Africa", "South Asia", "South Korea", "South Sudan", "South-East Asia Region", "Spain", "Sri Lanka", "Sub-Saharan Africa", "Sudan", "Suriname", "Sweden", "Switzerland", "Syria", "Taiwan", "Tajikistan", "Tanzania", "Thailand", "Togo", "Tokelau", "Tonga", "Trinidad and Tobago", "Tunisia", "Turkey", "Turkmenistan", "Tuvalu", "Uganda", "Ukraine", "United Arab Emirates", "United Kingdom", "United States", "United States Virgin Islands", "Uruguay", "Uzbekistan", "Vanuatu", "Venezuela", "Vietnam", "Wales", "Western Pacific Region ", "World", "Yemen", "Zambia", "Zimbabwe"
            ],
            "name": "Select a Country: "
          }
        }
      },
      "transform": [
        {
          "filter": {"selection": "CountrySelection"}
        },
        {
          "calculate": "datum['Smoking mortality'] / 1000000",
          "as": "Smoking Mortality (millions)"
        },
        {
          "aggregate": [
            {
              "op": "sum",
              "field": "Smoking Mortality (millions)",
              "as": "Total Smoking Mortality"
            }
          ],
          "groupby": ["Year"]
        },
        {
          "calculate": "format(datum['Total Smoking Mortality'], '.0f') + ' million people'",
          "as": "formattedTooltip"
        }
      ],
      "mark": "area",
      "encoding": {
        "x": {
          "field": "Year",
          "type": "ordinal",
          "title": "Year"
        },
        "y": {
          "field": "Total Smoking Mortality",
          "type": "quantitative",
          "title": "Total Smoking Mortality (millions)"
        },
        "stroke":{
          "value": "navy"
        },
        "color": {
          "value": "#f6caca"
        },
        "tooltip": [
          {"field": "Year", "type": "ordinal"},
          {"field": "formattedTooltip", "type": "nominal", "title": "Total Smoking Mortality"}
        ]
      }
    },
    {
      "transform": [
        {
          "filter": {"selection": "CountrySelection"}
        },
        {
          "calculate": "(datum['Smoking mortality'] / 1000000) + 1",
          "as": "Smoking Mortality (millions)"
        },
        {
          "aggregate": [
            {
              "op": "sum",
              "field": "Smoking Mortality (millions)",
              "as": "Total Smoking Mortality"
            }
          ],
          "groupby": ["Year"]
        },
        {
          "window": [
            {"op": "rank", "as": "rank"}
          ],
          "sort": [
            {"field": "Total Smoking Mortality", "order": "descending"}
          ]
        },
        {
          "filter": "datum.rank === 1"
        },
        {
          "calculate": "split('The highest smoking mortality \\n rates were observed in 2019, \\n with over 7,000 million lives \\n affected globally.', '\\n')",
          "as": "annotationText"
        },{
          "calculate": "split('The highest smoking\\nmortality for year ' + datum['Year']+ '\\n '+ '\\n '+ '\\n ', '\\n')",
          "as": "annotationText2"
        }
        
      ],
      
      "mark": {
        "type": "text",
        "align": "center",        
        "baseline": "middle",       
        "fontSize": 14,                
        "dx": 5,                        
        "dy": {"expr": "-datum['Total Smoking Mortality'] * 0.01  - 10"}                   
      },
      "encoding": {
        "x": {
          "field": "Year",
          "type": "ordinal",
          "align": "center"
        },
        "y": {
          "field": "Total Smoking Mortality",
          "type": "quantitative",
          "stack": "zero",
          "scale": {"zero": false},
          "axis": {"labelPadding": 10}
        },
         
        "text": {

          "condition": {
            "test": "CountrySelection_Entity != null",
            "field": "annotationText2"
          },
          "field": "annotationText"
        },
        "color": {"value": "#320c0c"}
      }
    }
  ]
}